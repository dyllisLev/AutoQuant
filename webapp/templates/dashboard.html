<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoQuant - ìë™ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { font-size: 24px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h2 { font-size: 18px; margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .stat { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .stat-label { color: #666; }
        .stat-value { font-weight: bold; color: #2c3e50; }
        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #2980b9; }
        .loading { text-align: center; padding: 20px; color: #7f8c8d; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; margin: 5px 0; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; }
        .result { background: #e8f5e9; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .prediction-list { list-style: none; }
        .prediction-list li { padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸš€ AutoQuant - ìë™ ì£¼ì‹ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ</h1>
            <p style="margin-top: 8px; opacity: 0.9;">ì‹¤ì‹œê°„ ë¶„ì„ Â· ìë™ ì˜ˆì¸¡ Â· ë°±í…ŒìŠ¤íŒ…</p>
        </div>
    </div>

    <div class="container">
        <div class="grid">
            <!-- ì£¼ê°€ ì¡°íšŒ -->
            <div class="card">
                <h2>ğŸ“ˆ ì£¼ê°€ ì¡°íšŒ</h2>
                <div class="form-group">
                    <label>ì¢…ëª©ì½”ë“œ</label>
                    <input type="text" id="priceticker" value="005930" placeholder="005930">
                </div>
                <div class="form-group">
                    <label>ê¸°ê°„ (ì¼)</label>
                    <input type="number" id="priceDays" value="30">
                </div>
                <button onclick="fetchPrice()">ì¡°íšŒ</button>
                <div id="priceResult" class="loading">ì¢…ëª©ì„ ì¡°íšŒí•´ì£¼ì„¸ìš”</div>
            </div>

            <!-- ê¸°ìˆ ì  ì§€í‘œ -->
            <div class="card">
                <h2>ğŸ“Š ê¸°ìˆ ì  ì§€í‘œ</h2>
                <div class="form-group">
                    <label>ì¢…ëª©ì½”ë“œ</label>
                    <input type="text" id="indicatorTicker" value="005930">
                </div>
                <button onclick="fetchIndicators()">ë¶„ì„</button>
                <div id="indicatorResult" class="loading">ë¶„ì„ì„ ì‹œì‘í•´ì£¼ì„¸ìš”</div>
            </div>

            <!-- ì£¼ê°€ ì˜ˆì¸¡ -->
            <div class="card">
                <h2>ğŸ”® ì£¼ê°€ ì˜ˆì¸¡ (AI)</h2>
                <div class="form-group">
                    <label>ì¢…ëª©ì½”ë“œ</label>
                    <input type="text" id="predictTicker" value="005930">
                </div>
                <div class="form-group">
                    <label>ëª¨ë¸</label>
                    <select id="predictModel">
                        <option value="LSTM">LSTM</option>
                        <option value="XGBoost">XGBoost</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì˜ˆì¸¡ ì¼ìˆ˜</label>
                    <input type="number" id="predictDays" value="7">
                </div>
                <button onclick="predictStock()">ì˜ˆì¸¡</button>
                <div id="predictResult" class="loading">ì˜ˆì¸¡ì„ ì‹œì‘í•´ì£¼ì„¸ìš”</div>
            </div>

            <!-- ë°±í…ŒìŠ¤íŒ… -->
            <div class="card">
                <h2>âš¡ ë°±í…ŒìŠ¤íŒ…</h2>
                <div class="form-group">
                    <label>ì „ëµ</label>
                    <select id="strategy">
                        <option value="SMA">SMA í¬ë¡œìŠ¤ì˜¤ë²„</option>
                        <option value="RSI">RSI ì „ëµ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì¢…ëª© (ì½¤ë§ˆë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="backtestTickers" value="005930,000660" placeholder="005930,000660,035420">
                </div>
                <button onclick="runBacktest()">ì‹¤í–‰</button>
                <div id="backtestResult" class="loading">ë°±í…ŒìŠ¤íŒ…ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”</div>
            </div>

            <!-- í¬íŠ¸í´ë¦¬ì˜¤ -->
            <div class="card">
                <h2>ğŸ’¼ í¬íŠ¸í´ë¦¬ì˜¤</h2>
                <button onclick="fetchPortfolio()">ìƒˆë¡œê³ ì¹¨</button>
                <div id="portfolioResult" class="loading">í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”</div>
            </div>

            <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
            <div class="card">
                <h2>âš™ï¸ ì‹œìŠ¤í…œ ìƒíƒœ</h2>
                <div class="stat">
                    <span class="stat-label">ë°ì´í„°ë² ì´ìŠ¤</span>
                    <span class="stat-value positive">âœ“ ì •ìƒ</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ì˜ˆì¸¡ ëª¨ë¸</span>
                    <span class="stat-value positive">âœ“ ì¤€ë¹„ë¨</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ë°±í…ŒìŠ¤íŒ… ì—”ì§„</span>
                    <span class="stat-value positive">âœ“ í™œì„±í™”</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</span>
                    <span class="stat-value" id="lastUpdate">ë°©ê¸ˆ ì „</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì£¼ê°€ ì¡°íšŒ
        async function fetchPrice() {
            const ticker = document.getElementById('priceicker').value;
            const days = document.getElementById('priceDays').value;
            const resultDiv = document.getElementById('priceResult');

            resultDiv.innerHTML = '<div class="loading">ì¡°íšŒ ì¤‘...</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/price?days=${days}`);
                const data = await response.json();

                if (data.length > 0) {
                    const latest = data[data.length - 1];
                    const oldest = data[0];
                    const change = ((latest.close - oldest.close) / oldest.close * 100).toFixed(2);
                    const changeClass = change >= 0 ? 'positive' : 'negative';

                    resultDiv.innerHTML = `
                        <div class="stat"><span>ì¢…ëª©</span><span class="stat-value">${ticker}</span></div>
                        <div class="stat"><span>í˜„ì¬ê°€</span><span class="stat-value">${latest.close.toLocaleString()}ì›</span></div>
                        <div class="stat"><span>ë“±ë½ë¥ </span><span class="stat-value ${changeClass}">${change}%</span></div>
                        <div class="stat"><span>ê³ ê°€</span><span>${Math.max(...data.map(d => d.high)).toLocaleString()}ì›</span></div>
                        <div class="stat"><span>ì €ê°€</span><span>${Math.min(...data.map(d => d.low)).toLocaleString()}ì›</span></div>
                        <div class="stat"><span>ê±°ë˜ëŸ‰</span><span>${latest.volume.toLocaleString()}ì£¼</span></div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">ì¡°íšŒ ì‹¤íŒ¨</div>';
            }
        }

        // ê¸°ìˆ ì  ì§€í‘œ
        async function fetchIndicators() {
            const ticker = document.getElementById('indicatorTicker').value;
            const resultDiv = document.getElementById('indicatorResult');

            resultDiv.innerHTML = '<div class="loading">ë¶„ì„ ì¤‘...</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/indicators`);
                const data = await response.json();

                let html = '';
                for (const [key, value] of Object.entries(data)) {
                    if (value !== null) {
                        html += `<div class="stat"><span>${key}</span><span class="stat-value">${value.toFixed(2)}</span></div>`;
                    }
                }
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">ë¶„ì„ ì‹¤íŒ¨</div>';
            }
        }

        // ì£¼ê°€ ì˜ˆì¸¡
        async function predictStock() {
            const ticker = document.getElementById('predictTicker').value;
            const model = document.getElementById('predictModel').value;
            const days = document.getElementById('predictDays').value;
            const resultDiv = document.getElementById('predictResult');

            resultDiv.innerHTML = '<div class="loading">ì˜ˆì¸¡ ì¤‘... (AI ëª¨ë¸ ì‹¤í–‰)</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/predict?model=${model}&days=${days}`);
                const data = await response.json();

                let html = '<ul class="prediction-list">';
                data.forEach(item => {
                    html += `<li><strong>${item.date}</strong>: ${item.predicted_price.toLocaleString()}ì›</li>`;
                });
                html += '</ul>';

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">ì˜ˆì¸¡ ì‹¤íŒ¨</div>';
            }
        }

        // ë°±í…ŒìŠ¤íŒ…
        async function runBacktest() {
            const strategy = document.getElementById('strategy').value;
            const tickers = document.getElementById('backtestTickers').value.split(',').map(t => t.trim());
            const resultDiv = document.getElementById('backtestResult');

            resultDiv.innerHTML = '<div class="loading">ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰ ì¤‘...</div>';

            try {
                const response = await fetch('/api/backtest', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({strategy, tickers})
                });
                const data = await response.json();

                const returnClass = data.total_return >= 0 ? 'positive' : 'negative';

                resultDiv.innerHTML = `
                    <div class="result">
                        <div class="stat"><span>ì „ëµ</span><span class="stat-value">${data.strategy}</span></div>
                        <div class="stat"><span>ì´ˆê¸° ìë³¸</span><span>${data.initial_capital.toLocaleString()}ì›</span></div>
                        <div class="stat"><span>ìµœì¢… ìë³¸</span><span>${data.final_capital.toLocaleString()}ì›</span></div>
                        <div class="stat"><span>ì´ ìˆ˜ìµë¥ </span><span class="stat-value ${returnClass}">${data.total_return.toFixed(2)}%</span></div>
                        <div class="stat"><span>ìƒ¤í”„ ë¹„ìœ¨</span><span>${data.sharpe_ratio.toFixed(2)}</span></div>
                        <div class="stat"><span>ìµœëŒ€ ë‚™í­</span><span class="negative">${data.max_drawdown.toFixed(2)}%</span></div>
                        <div class="stat"><span>ì´ ê±°ë˜</span><span>${data.total_trades}íšŒ</span></div>
                        <div class="stat"><span>ìŠ¹ë¥ </span><span class="positive">${data.win_rate.toFixed(2)}%</span></div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">ë°±í…ŒìŠ¤íŒ… ì‹¤íŒ¨</div>';
            }
        }

        // í¬íŠ¸í´ë¦¬ì˜¤
        async function fetchPortfolio() {
            const resultDiv = document.getElementById('portfolioResult');
            resultDiv.innerHTML = '<div class="loading">ì¡°íšŒ ì¤‘...</div>';

            try {
                const response = await fetch('/api/portfolio');
                const data = await response.json();

                const plClass = data.profit_loss.profit >= 0 ? 'positive' : 'negative';

                let html = '<div>';
                html += `<div class="stat"><span>í˜„ì¬ ê°€ì¹˜</span><span class="stat-value">${data.profit_loss.current_value.toLocaleString()}ì›</span></div>`;
                html += `<div class="stat"><span>ì†ìµ</span><span class="stat-value ${plClass}">${data.profit_loss.profit.toLocaleString()}ì› (${data.profit_loss.profit_rate.toFixed(2)}%)</span></div>`;
                html += `<div class="stat"><span>í˜„ê¸ˆ</span><span>${data.profit_loss.cash.toLocaleString()}ì›</span></div>`;
                html += '</div>';

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">ì¡°íšŒ ì‹¤íŒ¨</div>';
            }
        }

        // ìë™ ì—…ë°ì´íŠ¸
        setInterval(() => {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ko-KR');
        }, 1000);
    </script>
</body>
</html>
