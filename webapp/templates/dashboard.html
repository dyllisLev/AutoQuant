<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoQuant - 자동 트레이딩 시스템</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { font-size: 24px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h2 { font-size: 18px; margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .stat { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .stat-label { color: #666; }
        .stat-value { font-weight: bold; color: #2c3e50; }
        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #2980b9; }
        .loading { text-align: center; padding: 20px; color: #7f8c8d; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; margin: 5px 0; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; }
        .result { background: #e8f5e9; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .prediction-list { list-style: none; }
        .prediction-list li { padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>🚀 AutoQuant - 자동 주식 트레이딩 시스템</h1>
            <p style="margin-top: 8px; opacity: 0.9;">실시간 분석 · 자동 예측 · 백테스팅</p>
        </div>
    </div>

    <div class="container">
        <div class="grid">
            <!-- 주가 조회 -->
            <div class="card">
                <h2>📈 주가 조회</h2>
                <div class="form-group">
                    <label>종목코드</label>
                    <input type="text" id="priceticker" value="005930" placeholder="005930">
                </div>
                <div class="form-group">
                    <label>기간 (일)</label>
                    <input type="number" id="priceDays" value="30">
                </div>
                <button onclick="fetchPrice()">조회</button>
                <div id="priceResult" class="loading">종목을 조회해주세요</div>
            </div>

            <!-- 기술적 지표 -->
            <div class="card">
                <h2>📊 기술적 지표</h2>
                <div class="form-group">
                    <label>종목코드</label>
                    <input type="text" id="indicatorTicker" value="005930">
                </div>
                <button onclick="fetchIndicators()">분석</button>
                <div id="indicatorResult" class="loading">분석을 시작해주세요</div>
            </div>

            <!-- 주가 예측 -->
            <div class="card">
                <h2>🔮 주가 예측 (AI)</h2>
                <div class="form-group">
                    <label>종목코드</label>
                    <input type="text" id="predictTicker" value="005930">
                </div>
                <div class="form-group">
                    <label>모델</label>
                    <select id="predictModel">
                        <option value="LSTM">LSTM</option>
                        <option value="XGBoost">XGBoost</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>예측 일수</label>
                    <input type="number" id="predictDays" value="7">
                </div>
                <button onclick="predictStock()">예측</button>
                <div id="predictResult" class="loading">예측을 시작해주세요</div>
            </div>

            <!-- 백테스팅 -->
            <div class="card">
                <h2>⚡ 백테스팅</h2>
                <div class="form-group">
                    <label>전략</label>
                    <select id="strategy">
                        <option value="SMA">SMA 크로스오버</option>
                        <option value="RSI">RSI 전략</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>종목 (콤마로 구분)</label>
                    <input type="text" id="backtestTickers" value="005930,000660" placeholder="005930,000660,035420">
                </div>
                <button onclick="runBacktest()">실행</button>
                <div id="backtestResult" class="loading">백테스팅을 실행해주세요</div>
            </div>

            <!-- 포트폴리오 -->
            <div class="card">
                <h2>💼 포트폴리오</h2>
                <button onclick="fetchPortfolio()">새로고침</button>
                <div id="portfolioResult" class="loading">포트폴리오를 조회해주세요</div>
            </div>

            <!-- 시스템 상태 -->
            <div class="card">
                <h2>⚙️ 시스템 상태</h2>
                <div class="stat">
                    <span class="stat-label">데이터베이스</span>
                    <span class="stat-value positive">✓ 정상</span>
                </div>
                <div class="stat">
                    <span class="stat-label">예측 모델</span>
                    <span class="stat-value positive">✓ 준비됨</span>
                </div>
                <div class="stat">
                    <span class="stat-label">백테스팅 엔진</span>
                    <span class="stat-value positive">✓ 활성화</span>
                </div>
                <div class="stat">
                    <span class="stat-label">마지막 업데이트</span>
                    <span class="stat-value" id="lastUpdate">방금 전</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 주가 조회
        async function fetchPrice() {
            const ticker = document.getElementById('priceicker').value;
            const days = document.getElementById('priceDays').value;
            const resultDiv = document.getElementById('priceResult');

            resultDiv.innerHTML = '<div class="loading">조회 중...</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/price?days=${days}`);
                const data = await response.json();

                if (data.length > 0) {
                    const latest = data[data.length - 1];
                    const oldest = data[0];
                    const change = ((latest.close - oldest.close) / oldest.close * 100).toFixed(2);
                    const changeClass = change >= 0 ? 'positive' : 'negative';

                    resultDiv.innerHTML = `
                        <div class="stat"><span>종목</span><span class="stat-value">${ticker}</span></div>
                        <div class="stat"><span>현재가</span><span class="stat-value">${latest.close.toLocaleString()}원</span></div>
                        <div class="stat"><span>등락률</span><span class="stat-value ${changeClass}">${change}%</span></div>
                        <div class="stat"><span>고가</span><span>${Math.max(...data.map(d => d.high)).toLocaleString()}원</span></div>
                        <div class="stat"><span>저가</span><span>${Math.min(...data.map(d => d.low)).toLocaleString()}원</span></div>
                        <div class="stat"><span>거래량</span><span>${latest.volume.toLocaleString()}주</span></div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">조회 실패</div>';
            }
        }

        // 기술적 지표
        async function fetchIndicators() {
            const ticker = document.getElementById('indicatorTicker').value;
            const resultDiv = document.getElementById('indicatorResult');

            resultDiv.innerHTML = '<div class="loading">분석 중...</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/indicators`);
                const data = await response.json();

                let html = '';
                for (const [key, value] of Object.entries(data)) {
                    if (value !== null) {
                        html += `<div class="stat"><span>${key}</span><span class="stat-value">${value.toFixed(2)}</span></div>`;
                    }
                }
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">분석 실패</div>';
            }
        }

        // 주가 예측
        async function predictStock() {
            const ticker = document.getElementById('predictTicker').value;
            const model = document.getElementById('predictModel').value;
            const days = document.getElementById('predictDays').value;
            const resultDiv = document.getElementById('predictResult');

            resultDiv.innerHTML = '<div class="loading">예측 중... (AI 모델 실행)</div>';

            try {
                const response = await fetch(`/api/stock/${ticker}/predict?model=${model}&days=${days}`);
                const data = await response.json();

                let html = '<ul class="prediction-list">';
                data.forEach(item => {
                    html += `<li><strong>${item.date}</strong>: ${item.predicted_price.toLocaleString()}원</li>`;
                });
                html += '</ul>';

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">예측 실패</div>';
            }
        }

        // 백테스팅
        async function runBacktest() {
            const strategy = document.getElementById('strategy').value;
            const tickers = document.getElementById('backtestTickers').value.split(',').map(t => t.trim());
            const resultDiv = document.getElementById('backtestResult');

            resultDiv.innerHTML = '<div class="loading">백테스팅 실행 중...</div>';

            try {
                const response = await fetch('/api/backtest', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({strategy, tickers})
                });
                const data = await response.json();

                const returnClass = data.total_return >= 0 ? 'positive' : 'negative';

                resultDiv.innerHTML = `
                    <div class="result">
                        <div class="stat"><span>전략</span><span class="stat-value">${data.strategy}</span></div>
                        <div class="stat"><span>초기 자본</span><span>${data.initial_capital.toLocaleString()}원</span></div>
                        <div class="stat"><span>최종 자본</span><span>${data.final_capital.toLocaleString()}원</span></div>
                        <div class="stat"><span>총 수익률</span><span class="stat-value ${returnClass}">${data.total_return.toFixed(2)}%</span></div>
                        <div class="stat"><span>샤프 비율</span><span>${data.sharpe_ratio.toFixed(2)}</span></div>
                        <div class="stat"><span>최대 낙폭</span><span class="negative">${data.max_drawdown.toFixed(2)}%</span></div>
                        <div class="stat"><span>총 거래</span><span>${data.total_trades}회</span></div>
                        <div class="stat"><span>승률</span><span class="positive">${data.win_rate.toFixed(2)}%</span></div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">백테스팅 실패</div>';
            }
        }

        // 포트폴리오
        async function fetchPortfolio() {
            const resultDiv = document.getElementById('portfolioResult');
            resultDiv.innerHTML = '<div class="loading">조회 중...</div>';

            try {
                const response = await fetch('/api/portfolio');
                const data = await response.json();

                const plClass = data.profit_loss.profit >= 0 ? 'positive' : 'negative';

                let html = '<div>';
                html += `<div class="stat"><span>현재 가치</span><span class="stat-value">${data.profit_loss.current_value.toLocaleString()}원</span></div>`;
                html += `<div class="stat"><span>손익</span><span class="stat-value ${plClass}">${data.profit_loss.profit.toLocaleString()}원 (${data.profit_loss.profit_rate.toFixed(2)}%)</span></div>`;
                html += `<div class="stat"><span>현금</span><span>${data.profit_loss.cash.toLocaleString()}원</span></div>`;
                html += '</div>';

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<div class="negative">조회 실패</div>';
            }
        }

        // 자동 업데이트
        setInterval(() => {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ko-KR');
        }, 1000);
    </script>
</body>
</html>
