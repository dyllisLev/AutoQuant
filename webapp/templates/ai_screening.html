{% extends "base.html" %}

{% block title %}AIìŠ¤í¬ë¦¬ë‹{% endblock %}

{% block content %}
<div x-data="aiScreening()" x-init="loadData()">

    <!-- Page Header -->
    <div class="glass rounded-2xl p-6 shadow-lg mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¤– AI ìŠ¤í¬ë¦¬ë‹</h1>
        <p class="text-gray-600">4,359ê°œ ì¢…ëª© â†’ 35ê°œ AI ì„ ì • í›„ë³´ Â· ì˜ë¯¸ì  ë¶„ì„ ê¸°ë°˜</p>
    </div>

    <!-- Loading -->
    <div x-show="loading" class="flex justify-center items-center h-64">
        <div class="loading"></div>
    </div>

    <!-- Candidates List -->
    <div x-show="!loading && candidates.length > 0" class="space-y-4">

        <!-- Candidate Card -->
        <template x-for="(candidate, index) in candidates" :key="index">
            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition-all">

                <!-- Header -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold"
                             x-text="candidate.rank">
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800" x-text="candidate.name"></h3>
                            <p class="text-sm text-gray-500" x-text="candidate.code"></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700"
                              x-text="candidate.sector">
                        </span>
                    </div>
                </div>

                <!-- Score & Price -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-4 text-center">
                        <div class="text-xs text-gray-600 mb-1">AI ì ìˆ˜</div>
                        <div class="text-3xl font-bold text-purple-600" x-text="candidate.ai_score.toFixed(1)"></div>
                    </div>
                    <div class="bg-white rounded-lg p-4 text-center">
                        <div class="text-xs text-gray-500 mb-1">í˜„ì¬ê°€</div>
                        <div class="text-xl font-bold text-gray-800" x-text="formatPrice(candidate.price)"></div>
                        <div class="text-xs text-gray-500 mt-1" x-text="formatVolume(candidate.volume)"></div>
                    </div>
                </div>

                <!-- AI Reasoning -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="flex items-start space-x-2">
                        <div class="text-blue-600 text-lg mt-0.5">ğŸ’¡</div>
                        <div>
                            <div class="text-sm font-semibold text-blue-800 mb-1">AI ì„ ì • ì´ìœ </div>
                            <p class="text-sm text-blue-700 leading-relaxed" x-text="candidate.reason"></p>
                        </div>
                    </div>
                </div>

            </div>
        </template>

    </div>

    <!-- Empty State -->
    <div x-show="!loading && candidates.length === 0" class="glass rounded-xl p-12 shadow-lg text-center">
        <div class="text-6xl mb-4">ğŸ¤–</div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">AI ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600">ìƒˆë¡œìš´ ë¶„ì„ì´ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>

</div>

<script>
function aiScreening() {
    return {
        candidates: [],
        loading: false,
        runId: null,

        async loadData() {
            this.loading = true;
            try {
                // Get latest run_id from dashboard
                const dashResponse = await fetch('/api/dashboard');
                const dashData = await dashResponse.json();
                this.runId = dashData.run_id;

                // Get AI candidates
                const response = await fetch(`/api/ai-candidates/${this.runId}`);
                const data = await response.json();
                this.candidates = data.candidates || [];
            } catch (error) {
                console.error('Error loading AI candidates:', error);
                alert('AI ìŠ¤í¬ë¦¬ë‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                this.loading = false;
            }
        },

        formatPrice(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.round(num)) + 'ì›';
        },

        formatVolume(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'ë°±ë§Œì£¼';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'ì²œì£¼';
            }
            return num + 'ì£¼';
        }
    }
}
</script>
{% endblock %}
