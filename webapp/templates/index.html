{% extends "base.html" %}

{% block title %}ÎåÄÏãúÎ≥¥Îìú{% endblock %}

{% block content %}
<div x-data="dashboard()" x-init="loadDashboard()">

    <!-- Loading State -->
    <div x-show="loading" class="flex justify-center items-center h-64">
        <div class="loading"></div>
    </div>

    <!-- Dashboard Content -->
    <div x-show="!loading && data" class="space-y-6">

        <!-- Header Card -->
        <div class="glass rounded-2xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-800">ÏµúÏã† Î∂ÑÏÑù Í≤∞Í≥º</h2>
                <span class="px-4 py-1 rounded-full text-sm font-semibold"
                      :class="{
                          'bg-green-100 text-green-700': data.market.sentiment === 'BULLISH',
                          'bg-yellow-100 text-yellow-700': data.market.sentiment === 'NEUTRAL',
                          'bg-red-100 text-red-700': data.market.sentiment === 'BEARISH'
                      }"
                      x-text="data.market.sentiment">
                </span>
            </div>

            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-white rounded-xl shadow-sm">
                    <div class="text-3xl mb-2">üìÖ</div>
                    <div class="text-sm text-gray-500">Î∂ÑÏÑùÏùº</div>
                    <div class="font-bold text-gray-800" x-text="data.analysis_date"></div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-sm">
                    <div class="text-3xl mb-2">üìà</div>
                    <div class="text-sm text-gray-500">KOSPI</div>
                    <div class="font-bold" :class="data.market.change_pct >= 0 ? 'text-red-600' : 'text-blue-600'"
                         x-text="formatPrice(data.market.kospi) + ' ' + formatPercent(data.market.change_pct)">
                    </div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-sm">
                    <div class="text-3xl mb-2">üéØ</div>
                    <div class="text-sm text-gray-500">Î™©ÌëúÍ±∞ÎûòÏùº</div>
                    <div class="font-bold text-gray-800" x-text="data.target_date"></div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-sm">
                    <div class="text-3xl mb-2">üí∞</div>
                    <div class="text-sm text-gray-500">Îß§Îß§Ïã†Ìò∏</div>
                    <div class="font-bold text-blue-600" x-text="data.stats.final_signals + 'Í∞ú'"></div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Total Stocks -->
            <div class="glass rounded-xl p-6 shadow-lg card-hover cursor-pointer">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-700">Ï†ÑÏ≤¥ Ï¢ÖÎ™© Î∂ÑÏÑù</h3>
                    <span class="text-3xl">üìä</span>
                </div>
                <div class="text-4xl font-bold text-gray-800 mb-2" x-text="formatNumber(data.stats.total_stocks)"></div>
                <div class="text-sm text-gray-500">Í∞ú Ï¢ÖÎ™© Ïä§Ï∫î ÏôÑÎ£å</div>
                <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-blue-500 to-blue-600" style="width: 100%"></div>
                </div>
            </div>

            <!-- AI Candidates -->
            <div class="glass rounded-xl p-6 shadow-lg card-hover cursor-pointer" @click="window.location.href='/ai-screening'">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-700">AI ÏÑ†Ï†ï Ï¢ÖÎ™©</h3>
                    <span class="text-3xl">ü§ñ</span>
                </div>
                <div class="text-4xl font-bold text-purple-600 mb-2" x-text="data.stats.ai_candidates"></div>
                <div class="text-sm text-gray-500">
                    <span>Ïä§ÌÅ¨Î¶¨Îãù ÎπÑÏú®: </span>
                    <span class="font-semibold" x-text="((data.stats.ai_candidates / data.stats.total_stocks) * 100).toFixed(2) + '%'"></span>
                </div>
                <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-500 to-purple-600"
                         :style="`width: ${(data.stats.ai_candidates / data.stats.total_stocks) * 100}%`"></div>
                </div>
            </div>

            <!-- Final Signals -->
            <div class="glass rounded-xl p-6 shadow-lg card-hover cursor-pointer" @click="window.location.href='/signals'">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-700">ÏµúÏ¢Ö Îß§Îß§Ïã†Ìò∏</h3>
                    <span class="text-3xl">üéØ</span>
                </div>
                <div class="text-4xl font-bold text-green-600 mb-2" x-text="data.stats.final_signals"></div>
                <div class="text-sm text-gray-500">
                    <span>ÏÑ†Ï†ïÎ•†: </span>
                    <span class="font-semibold" x-text="((data.stats.final_signals / data.stats.ai_candidates) * 100).toFixed(2) + '%'"></span>
                </div>
                <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-green-500 to-green-600"
                         :style="`width: ${(data.stats.final_signals / data.stats.ai_candidates) * 100}%`"></div>
                </div>
            </div>
        </div>

        <!-- Analysis Funnel Visualization -->
        <div class="glass rounded-xl p-6 shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-6">Î∂ÑÏÑù ÌîåÎ°úÏö∞</h3>
            <div class="space-y-4">
                <!-- Stage 1 -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">1Ô∏è‚É£ Ï†ÑÏ≤¥ Ï¢ÖÎ™© Ïä§Ï∫î</span>
                        <span class="text-sm font-bold text-gray-800" x-text="formatNumber(data.stats.total_stocks) + 'Í∞ú'"></span>
                    </div>
                    <div class="h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white font-medium">
                        100%
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-center text-2xl text-gray-400">‚¨áÔ∏è</div>

                <!-- Stage 2 -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">2Ô∏è‚É£ AI Ïä§ÌÅ¨Î¶¨Îãù</span>
                        <span class="text-sm font-bold text-purple-600" x-text="data.stats.ai_candidates + 'Í∞ú'"></span>
                    </div>
                    <div class="h-8 bg-purple-500 rounded-lg flex items-center justify-center text-white font-medium"
                         :style="`width: ${(data.stats.ai_candidates / data.stats.total_stocks) * 100}%`"
                         x-text="((data.stats.ai_candidates / data.stats.total_stocks) * 100).toFixed(1) + '%'">
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-center text-2xl text-gray-400">‚¨áÔ∏è</div>

                <!-- Stage 3 -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">3Ô∏è‚É£ Í∏∞Ïà†Ï†Å Î∂ÑÏÑù</span>
                        <span class="text-sm font-bold text-orange-600" x-text="data.stats.technical_picks + 'Í∞ú'"></span>
                    </div>
                    <div class="h-8 bg-orange-500 rounded-lg flex items-center justify-center text-white font-medium"
                         :style="`width: ${(data.stats.technical_picks / data.stats.total_stocks) * 100}%`"
                         x-text="((data.stats.technical_picks / data.stats.total_stocks) * 100).toFixed(2) + '%'">
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-center text-2xl text-gray-400">‚¨áÔ∏è</div>

                <!-- Stage 4 -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">4Ô∏è‚É£ ÏµúÏ¢Ö Îß§Îß§Ïã†Ìò∏ (R/R 2.0+)</span>
                        <span class="text-sm font-bold text-green-600" x-text="data.stats.final_signals + 'Í∞ú'"></span>
                    </div>
                    <div class="h-8 bg-green-500 rounded-lg flex items-center justify-center text-white font-medium"
                         :style="`width: ${(data.stats.final_signals / data.stats.total_stocks) * 100}%`"
                         x-text="((data.stats.final_signals / data.stats.total_stocks) * 100).toFixed(3) + '%'">
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="/signals" class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition-all flex items-center justify-between group">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Îß§Îß§Ïã†Ìò∏ Î≥¥Í∏∞</h3>
                    <p class="text-sm text-gray-600">R/R 2.0 Ïù¥ÏÉÅ Î≥¥Ïû• Ïã†Ìò∏ ÌôïÏù∏</p>
                </div>
                <div class="text-4xl group-hover:scale-110 transition-transform">üí∞</div>
            </a>

            <a href="/market" class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition-all flex items-center justify-between group">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">ÏãúÏû• Î∂ÑÏÑù</h3>
                    <p class="text-sm text-gray-600">5-factor Î™®Î©òÌÖÄ Î∞è ÏÑºÌã∞Î®ºÌä∏</p>
                </div>
                <div class="text-4xl group-hover:scale-110 transition-transform">üåê</div>
            </a>
        </div>

    </div>

</div>

<script>
function dashboard() {
    return {
        data: null,
        loading: false,

        async loadDashboard() {
            this.loading = true;
            try {
                const response = await fetch('/api/dashboard');
                this.data = await response.json();
            } catch (error) {
                console.error('Error loading dashboard:', error);
                alert('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            } finally {
                this.loading = false;
            }
        },

        formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        },

        formatPrice(num) {
            return this.formatNumber(num);
        },

        formatPercent(num) {
            return `${num >= 0 ? '+' : ''}${num.toFixed(2)}%`;
        }
    }
}
</script>
{% endblock %}
